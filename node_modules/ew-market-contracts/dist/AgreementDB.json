{"abi":[{"constant":true,"inputs":[],"name":"getAllAgreementListLengthDB","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_agreementId","type":"uint256"},{"name":"_matcherPropertiesDocumentHash","type":"string"},{"name":"_matcherDBURL","type":"string"}],"name":"setMatcherPropertiesAndURL","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_agreementId","type":"uint256"},{"name":"_matchers","type":"address[]"}],"name":"setAgreementMatcher","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_agreementId","type":"uint256"}],"name":"getAgreementDB","outputs":[{"components":[{"name":"propertiesDocumentHash","type":"string"},{"name":"documentDBURL","type":"string"},{"name":"matcherPropertiesDocumentHash","type":"string"},{"name":"matcherDBURL","type":"string"},{"name":"demandId","type":"uint256"},{"name":"supplyId","type":"uint256"},{"name":"approvedBySupplyOwner","type":"bool"},{"name":"approvedByDemandOwner","type":"bool"},{"name":"allowedMatcher","type":"address[]"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_agreementId","type":"uint256"}],"name":"approveAgreementSupplyDB","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_agreementId","type":"uint256"}],"name":"approveAgreementDemandDB","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_propertiesDocumentHash","type":"string"},{"name":"_documentDBURL","type":"string"},{"name":"_matcherPropertiesDocumentHash","type":"string"},{"name":"_matcherDBURL","type":"string"},{"name":"_demandId","type":"uint256"},{"name":"_supplyId","type":"uint256"}],"name":"createAgreementDB","outputs":[{"name":"_agreementId","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_newOwner","type":"address"}],"name":"LogChangeOwner","type":"event"}],"bytecode":"","contractName":"AgreementDB","deployedBytecode":"","source":"// Copyright 2018 Energy Web Foundation\n// This file is part of the Origin Application brought to you by the Energy Web Foundation,\n// a global non-profit organization focused on accelerating blockchain technology across the energy sector,\n// incorporated in Zug, Switzerland.\n//\n// The Origin Application is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n// This is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY and without an implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details, at <http://www.gnu.org/licenses/>.\n//\n// @authors: slock.it GmbH; Martin Kuechler, martin.kuchler@slock.it; Heiko Burkhardt, heiko.burkhardt@slock.it\n\npragma solidity ^0.5.2;\npragma experimental ABIEncoderV2;\n\nimport \"ew-utils-general-contracts/contracts/Msc/Owned.sol\";\n\ncontract AgreementDB is Owned {\n\n    struct Agreement {\n        string propertiesDocumentHash;\n        string documentDBURL;\n        string matcherPropertiesDocumentHash;\n        string matcherDBURL;\n        uint demandId;\n        uint supplyId;\n        bool approvedBySupplyOwner;\n        bool approvedByDemandOwner;\n        address[] allowedMatcher;\n    }\n\n    /// @notice list with all created agreements\n    Agreement[] private allAgreements;\n\n\n\t/// @notice approves an demand for an agreement\n\t/// @param _agreementId the agreement Id\n\t/// @return true when both supply and demand agreed\n    function approveAgreementDemandDB(uint _agreementId)\n        onlyOwner\n        external\n        returns (bool)\n    {\n        Agreement storage a = allAgreements[_agreementId];\n        a.approvedByDemandOwner = true;\n        return (a.approvedByDemandOwner && a.approvedBySupplyOwner);\n    }\n\n\t/// @notice approves an supply for an agreement\n\t/// @param _agreementId the agreement Id\n\t/// @return true when both supply and demand agreed\n    function approveAgreementSupplyDB(uint _agreementId)\n        onlyOwner\n        external\n        returns (bool)\n    {\n        Agreement storage a = allAgreements[_agreementId];\n        a.approvedBySupplyOwner = true;\n        return (a.approvedByDemandOwner && a.approvedBySupplyOwner);\n    }\n\n\t/// @notice function to create a agreement\n\t/// @param _propertiesDocumentHash document-hash with all the properties of the agreement\n\t/// @param _documentDBURL url-address of the agreement\n\t/// @param _demandId the demand Id\n\t/// @param _supplyId the supply Id\n\t/// @return the index and thus the identifier of a agreement\n    function createAgreementDB\n    (\n        string calldata _propertiesDocumentHash,\n        string calldata _documentDBURL,\n        string calldata _matcherPropertiesDocumentHash,\n        string calldata _matcherDBURL,\n        uint _demandId,\n        uint _supplyId\n   )\n        external\n        onlyOwner\n        returns (uint _agreementId)\n    {\n\n        address[] memory emptyMatcher = new address[](0);\n        allAgreements.push(Agreement({\n            propertiesDocumentHash: _propertiesDocumentHash,\n            documentDBURL: _documentDBURL,\n            matcherPropertiesDocumentHash: _matcherPropertiesDocumentHash,\n            matcherDBURL: _matcherDBURL,\n            demandId: _demandId,\n            supplyId: _supplyId,\n            approvedBySupplyOwner: false,\n            approvedByDemandOwner: false,\n            allowedMatcher: emptyMatcher\n        }));\n        _agreementId = allAgreements.length>0?allAgreements.length-1:0;\n\n    }\n\n    /// @notice set the matchers for an agreement\n    /// @param _agreementId id of an agreement\n    /// @param _matchers matcher-array \n    function setAgreementMatcher(\n        uint _agreementId,\n        address[] calldata _matchers\n    )\n        external \n        onlyOwner\n    {\n        Agreement storage a = allAgreements[_agreementId];\n        a.allowedMatcher = _matchers;\n    }\n\n    /// @notice sets the matcherProperties for an agreement\n    /// @param _agreementId id of an agreement\n    /// @param _matcherPropertiesDocumentHash document-hash of the matcher properties\n    /// @param _matcherDBURL db-url of the document-hash\n    function setMatcherPropertiesAndURL(\n        uint _agreementId,\n        string calldata _matcherPropertiesDocumentHash,\n        string calldata _matcherDBURL\n    )\n        external \n        onlyOwner\n    {\n        Agreement storage a = allAgreements[_agreementId];\n        a.matcherPropertiesDocumentHash = _matcherPropertiesDocumentHash;\n        a.matcherDBURL = _matcherDBURL;\n    }\n\n\t/// @notice Returns a agreement-struct\n\t/// @param _agreementId id of a agreement\n\t/// @return returns a agreement-struct\n    function getAgreementDB(uint _agreementId)\n        external\n        view\n        onlyOwner\n        returns (Agreement memory)\n    {\n        return allAgreements[_agreementId];\n    }\n\n\t/// @notice funtion to retrieve the length of the allagreements-array\n\t/// @return the length of the allagreements-array\n    function getAllAgreementListLengthDB()\n        external\n        view\n        onlyOwner\n        returns (uint)\n    {\n        return allAgreements.length;\n    }\n}\n","networks":"{}"}